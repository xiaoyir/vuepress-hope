# 微信扫码登录是如何实现的？

大家好，我是小义。在数字化时代，微信扫码登录作为一种便捷、安全的登录方式，越来越多的出现在人们的日常生活中。

它不仅仅是一种登录手段，其背后蕴含的是一种安全认证机制和用户身份验证的创新。对于开发者来说，理解这一机制，不仅能够提升产品的用户体验，还能增强系统的安全性。而且微信扫码登录原理这个问题在阿里、腾讯、京东等大厂的面试中也是个高频面试题。

## 基本原理

微信扫码登录，本质上是一种基于OAuth 2.0协议的授权机制。OAuth 2.0是一个用于授权的行业标准协议，它允许应用代表用户与另一个应用通信，而无需用户将他们的密码提供给第三方应用。用户通过扫描应用提供的二维码，授权应用获取其微信账号的某些权限，从而实现快速登录，比如手机微信扫码登录PC端网页版微信，手机淘宝扫码登录PC端淘宝等。

## 登录解析

### 一、token交互

在解析PC端微信如何扫码登录之前，先来了解一下手机端微信APP是如何与服务器通信的。交互流程大致如下，移动端请求服务端API需要携带token，从而保证接口的安全性。

![img](https://javacool.oss-cn-shenzhen.aliyuncs.com/img/xyr/20240525174509.png)


token其实就是一串有着特殊意义的字符串，服务器用它来查找账号和设备信息，比如cisalTejZRixyocDEkeGfLvSPkrqDnNP就可能映射下面这一数据结构。

```
{
  accountId:'账号ID',
  deviceId:'登录的设备ID',
  expired:'有效期',
  //...
}
```

### 二、PC端扫码登录

当在电脑微信网页版登录微信时，需要手机扫码配合。


PC端刚开始显示的二维码由服务器生成，按F12查看浏览器控制台，可以看到页面在定时轮询查看二维码状态。

![img_1](https://javacool.oss-cn-shenzhen.aliyuncs.com/img/xyr/20240525174522.png)

二维码可分为未扫描、已扫描、已登录三种状态，此时为未扫描。生成的二维码id会和设备信息绑定。

![img_2](https://javacool.oss-cn-shenzhen.aliyuncs.com/img/xyr/20240525174539.png)


接下来看看手机端是如何扫码登录PC端的。

1.  当手机扫码这个二维码获取id并发送给服务端时，服务器会专门生成一个临时token，用作手机端扫码确认登录这一操作的安全校验机制，同时变更二维码状态为已扫描。

2.  PC端继续定时轮询二维码状态，二维码“已扫描”则界面展示基本用户信息。

3.  手机端点击确认登录，服务端校验，生成PC端token，变更二维码状态为已登录。

4.  PC端检测到二维码状态已登录，从而获取到正式token，进入微信主界面。


以上四个步骤具体流程大致如下。

![img_3](https://javacool.oss-cn-shenzhen.aliyuncs.com/img/xyr/20240525174549.png)

## 结语

微信扫码登录不仅仅是一个技术问题，它的实现过程充分展现了现代网络环境下用户体验和安全性的双重考量。通过深入解析这一背后的技术原理，可以对网络信息安全和用户体验有更为细致的认识，而且再也不怕被面试官吊打啦。